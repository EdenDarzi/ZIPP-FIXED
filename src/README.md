# Firebase Studio

This is a NextJS starter in Firebase Studio.

To get started, take a look at src/app/page.tsx.

## חזון ארכיטקטוני עתידי (SwiftServe v1.0 – Architecture Blueprint)

התכנון הארכיטקטוני המוצע עבור מערכת SwiftServe בגרסתה הראשונה (v1.0) מבוסס על שירותים מודולריים וניתנים להרחבה:

```text
Client (Web & Mobile via Capacitor)
│
├── API Gateway (REST + WebSockets)
│   ├── Auth Service (NextAuth / Firebase)
│   ├── Delivery Engine (matching, pricing, routing)
│   ├── Order Manager
│   ├── Wallet/Payments (Stripe Connect)
│   └── AI Engine (Genkit Runtime, Vector Store, LLMs)
│
├── Database (PostgreSQL + Redis)
├── Storage (Firebase S3 for media)
└── Realtime Service (PubSub or Firestore listeners)
```

**פירוט הרכיבים:**

*   **Client (Web & Mobile via Capacitor):** אפליקציית צד לקוח שנכתבה ב-Next.js ו-React, עם אפשרות לעטוף אותה באמצעות Capacitor להפצה בחנויות האפליקציות (iOS/Android) וגישה ליכולות חומרה.
*   **API Gateway (REST + WebSockets):** נקודת הכניסה המרכזית לבקשות מהלקוח. תומך ב-REST API לפעולות סטנדרטיות וב-WebSockets לתקשורת דו-כיוונית בזמן אמת (למשל, עדכוני הזמנות, צ'אט).
*   **Auth Service:** אחראי על אימות וניהול משתמשים והרשאותיהם (למשל, באמצעות NextAuth.js או Firebase Authentication).
*   **Delivery Engine:** ליבת המערכת הלוגיסטית. כולל אלגוריתמים להתאמת שליחים, תמחור דינמי, ואופטימיזציית מסלולים.
*   **Order Manager:** מטפל בכל הלוגיקה הקשורה לניהול הזמנות – יצירה, עדכון סטטוסים, היסטוריה.
*   **Wallet/Payments:** ניהול ארנקים דיגיטליים לכל סוגי המשתמשים ואינטגרציה עם ספקי תשלום (למשל, Stripe Connect) לביצוע סליקה, העברות ותשלומים.
*   **AI Engine:** מנוע הבינה המלאכותית, המבוסס על Genkit Runtime עצמאי. כולל גישה למודלי שפה גדולים (LLMs) ואולי ל-Vector Store לצורך חיפושים סמנטיים והמלצות מתקדמות.
*   **Database (PostgreSQL + Redis):** בסיס נתונים ראשי (למשל, PostgreSQL) לשמירת נתונים רלציוניים ומובנים, עם שימוש ב-Redis עבור Caching וניהול נתונים מהירים (כמו מיקומי שליחים בזמן אמת).
*   **Storage (Firebase S3 for media):** פתרון אחסון לקבצי מדיה כמו תמונות (לוגואים, מנות, פריטי יד2).
*   **Realtime Service (PubSub or Firestore listeners):** שירות להעברת הודעות ועדכונים בזמן אמת בין רכיבי המערכת השונים (למשל, עדכון הלקוח על סטטוס הזמנה חדש).

ארכיטקטורה זו נועדה לספק גמישות, יכולת גדילה (scalability) ואפשרות לתחזוקה נוחה של כל רכיב בנפרד.

## מפת דרכים למערכת פרודקשן מלאה (מעבר לפרוטוטייפ)

הפרוטוטייפ הנוכחי מהווה בסיס איתן. להלן התכונות והיכולות המרכזיות הנדרשות להפיכת SwiftServe למערכת פרודקשן מקיפה ומתקדמת:

**1. מערכת תשלומים מלאה (Wallets + Gateway):**
*   אינטגרציה עם ספקי תשלום מאובטחים כגון Stripe Connect או Tranzila API.
*   מימוש ארנקים דיגיטליים לכל סוגי המשתמשים (לקוח, שליח, עסק) עם מעקב תנועות מפורט.
*   תמיכה במגוון אמצעי תשלום: כרטיסי אשראי, Google Pay, Apple Pay.
*   מנגנון חלוקת תשלומים אוטומטי ויעיל (לדוגמה, תשלום מהלקוח מתחלק בין העסק, השליח, ועמלת הפלטפורמה).

**2. מיקום וזמן אמת (Real-Time Capabilities):**
*   אינטגרציה מלאה עם שירותי מיפוי כמו Google Maps API (Distance Matrix, Geocoding, Directions).
*   מעקב GPS חי אחר מיקום שליחים.
*   שימוש ב-WebSockets (למשל, דרך Firestore listeners או Pub/Sub) לעדכוני סטטוס הזמנה, מיקום וצ'אט בזמן אמת.
*   חישוב והצגת ETA (זמן הגעה משוער) דינמי למשלוח.
*   צ'אט חי בין משתמשים (לקוח ↔ שליח, עסק ↔ שליח, לקוח ↔ עסק).

**3. אפליקציית מובייל ייעודית (Native or Hybrid):**
*   עטיפת אפליקציית ה-Web באמצעות Capacitor (כפי שצוין בארכיטקטורה) או פיתוח באמצעות Expo / React Native.
*   מימוש מלא של התראות Push למובייל עבור כל העדכונים הרלוונטיים (סטטוס הזמנה, הודעות צ'אט, הצעות חדשות).
*   עיצוב Splash screen ואייקון אפליקציה מותאמים.
*   תהליכי הפצה ועדכון דרך חנויות האפליקציות (App Store, Play Store).

**4. אבטחה ותשתיות DevOps:**
*   הטמעת מנגנוני אבטחה כגון Rate Limiting, הגנה מפני CSRF/XSS, וניהול סודות מאובטח.
*   אינטגרציה עם כלי ניטור אפליקטיבי כמו Sentry או LogRocket לזיהוי ותיקון שגיאות בזמן אמת.
*   הקמת תהליכי CI/CD (למשל, עם GitHub Actions) לפריסה אוטומטית, בדיקות, ואינטגרציה רציפה.
*   ביצוע בדיקות ביצועים, נגישות ואבטחה אוטומטיות (למשל, Lighthouse, OWASP ZAP).

**5. הרחבת יכולות ניהול (Admin Dashboards):**
*   **ניהול עסקים:** ממשק מלא לפתיחה ואישור עסקים חדשים, הגדרת עמלות, ניהול פרופילים, והשעיית חשבונות.
*   **ניהול תשלומים:** כלי בקרה על תשלומים, החזרים כספיים, ומשיכות כספים מארנקים.
*   **ניהול משלוחים:** בקרה על זמינות שליחים, ניהול אזורי משלוח מתקדמים, והתערבות ידנית במקרי קצה.
*   **מערכת דיווחים ותמיכה:** ממשק לטיפול בפניות, תלונות, וניהול תכני תמיכה (FAQ, מדריכים).

**6. פיצ'רים משלימים חשובים:**
*   **מערכת הודעות פנימית (Inbox):** בנוסף לצ'אט, מערכת הודעות אסינכרונית בין משתמשים והפלטפורמה.
*   **מערכת התראות מתקדמת:** התראות Push, SMS ואימייל הניתנות להתאמה אישית על ידי המשתמש.
*   **המלצות AI משופרות:** שימוש בנתונים אמיתיים לאימון מודלי ההמלצות והתאמה אישית עמוקה יותר.
*   **ניהול אזורי משלוח מתקדם:** תמחור דינמי לפי אזור, שעות, ומרחק.
*   **ממשק ניהול מנויים:** עבור תוכניות פרימיום לשליחים ועסקים, כולל ניהול חיובים ותכונות.
*   **מודול Split Tips:** אפשרות לחלוקת טיפים בין מספר שליחים במקרה של משלוחים משולבים (Multi-Drop).
*   **תיעוד מסירה:** אפשרות לשליח לצלם תמונה או וידאו קצר כהוכחת מסירה (במיוחד למשלוחים יקרי ערך או רגישים).

## מודל התמחור של מערכת SwiftServe – גרסה מתקדמת

אלגוריתם המשלוחים של המערכת נבנה לפי עקרונות דינמיים תוך התאמה בזמן אמת:

*   **תמחור לפי מרחק:** 20 ₪ לק"מ הראשון + 5 ₪ לכל ק"מ נוסף.
*   **משקל/גודל חריג:** תוספת עבור פריטים כבדים או גדולים.
*   **כניסה רגלית/מדרגות:** תוספת עבור מאמץ רגלי במשלוח.
*   **ביטול הזמנה:** תמחור נפרד לביטול לפני/אחרי יציאת שליח.
*   **שעת משלוח:** מודל דינמי: שעות שיא, לילה, שבת, גשם – כל אחת בתוספת משלה.
*   **משלוח אקספרס:** תוספת קבועה להזמנות דחופות.
*   **ביטוח משלוח:** תוספת יחסית לערך החבילה לפי אחוז (כגון 2%).
*   **טיפ לשליח:** ניתן להזנה מהלקוח בזמן/לאחר ההזמנה.
*   **פריסה אזורית:** עלויות שונות לפי אזור מגורים (תל אביב ללא תוספת, אילת תוספת 20 ₪).

האלגוריתם ניתן להגדרה דרך Admin Panel בצורה נוחה, ומתוכנן להיות מבוסס TypeScript בצד השרת (API) לצורך גמישות מלאה בעתיד (חיבור ל-Admin Panel, אפליקציות וכו').

